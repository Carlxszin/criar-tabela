<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucro em Criptomoedas</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0a1122, #1a2236);
            color: #ffffff;
            min-height: 100vh;
            font-weight: 500;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 5%;
        }

        /* Cabe√ßalho */
        header {
            background: rgba(10, 17, 34, 0.95);
            backdrop-filter: blur(12px);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 2rem;
            color: #3b82f6;
            text-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
            font-weight: 700;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 1.5rem;
        }

        nav a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: color 0.3s, transform 0.2s;
        }

        nav a:hover {
            color: #7c3aed;
            transform: scale(1.1);
        }

        .menu-toggle {
            display: none;
            font-size: 1.8rem;
            color: #ffffff;
            cursor: pointer;
        }

        /* Formul√°rio */
        #form-section {
            background: rgba(20, 30, 48, 0.95);
            padding: 2.5rem;
            margin: 2rem 0;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(6px);
        }

        #form-section h2 {
            font-size: 2.5rem;
            color: #3b82f6;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }

        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            justify-items: center;
        }

        form input, form select {
            padding: 0.75rem;
            font-size: 1rem;
            border: 2px solid #4b5563;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            width: 100%;
            transition: border-color 0.3s, transform 0.2s, box-shadow 0.3s;
        }

        form select {
            background: rgba(255, 255, 255, 0.05);
        }

        form input:focus, form select:focus {
            border-color: #7c3aed;
            transform: scale(1.02);
            box-shadow: 0 0 8px rgba(124, 58, 237, 0.5);
            outline: none;
        }

        form button {
            padding: 0.75rem 1.5rem;
            font-size: 1.1rem;
            background: linear-gradient(90deg, #2b6cb0, #6b21a8);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        form button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(124, 58, 237, 0.6);
        }

        .error {
            color: #f87171;
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        /* Modal de Edi√ß√£o */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #141e30;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            backdrop-filter: blur(6px);
        }

        .modal-content h2 {
            font-size: 2rem;
            color: #3b82f6;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .modal-content form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-content button[type="submit"] {
            background: #10b981;
        }

        .modal-content button[type="submit"]:hover {
            background: #059669;
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.6);
        }

        .close-btn {
            background: #f87171;
            color: #ffffff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        .close-btn:hover {
            background: #b91c1c;
            box-shadow: 0 0 10px rgba(248, 113, 113, 0.6);
        }

        /* Se√ß√£o de Resumo */
        #summary-section {
            background: rgba(20, 30, 48, 0.95);
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(6px);
            text-align: center;
        }

        #summary-section h2 {
            font-size: 2.5rem;
            color: #3b82f6;
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }

        #summary-content {
            background: #141e30;
            padding: 2rem;
            border-radius: 12px;
            color: #ffffff;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 800px;
            min-height: 400px;
            margin: 0 auto;
        }

        #summary-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #3b82f6, #7c3aed);
        }

        #summary-content h3 {
            font-size: 2.2rem;
            color: #7c3aed;
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(124, 58, 237, 0.5);
        }

        #summary-content p {
            font-size: 1.3rem;
            margin: 0.75rem 0;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
        }

        #summary-content p::before {
            content: 'üí∞';
            font-size: 1.3rem;
        }

        .chart-container {
            width: 100%;
            max-width: 600px;
            margin: 2rem auto;
            overflow: hidden;
        }

        #summary-chart, #weeklyChart {
            max-width: 100%;
            max-height: 400px;
            height: auto;
            display: block;
        }

        #download-btn {
            padding: 0.75rem 1.5rem;
            font-size: 1.1rem;
            background: linear-gradient(90deg, #10b981, #059669);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
            margin-top: 1.5rem;
        }

        #download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.6);
        }

        /* Se√ß√µes de Lucro */
        .profit-section {
            padding: 3rem 0;
            margin: 2rem 0;
        }

        .profit-section h2 {
            font-size: 2.5rem;
            color: #3b82f6;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }

        .profit-card {
            background: #141e30;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(6px);
        }

        .profit-card h3 {
            font-size: 2.8rem;
            color: #7c3aed;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        /* Cards de Lucro */
        .profit-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .profit-item {
            background: #141e30;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(6px);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .profit-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);
        }

        .profit-item h4 {
            font-size: 1.3rem;
            color: #3b82f6;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .profit-item p {
            font-size: 0.95rem;
            color: #ffffff;
            margin: 0.3rem 0;
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
        }

        /* Se√ß√£o de Exporta√ß√£o */
        #export-section {
            background: rgba(20, 30, 48, 0.95);
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(6px);
            text-align: center;
        }

        #export-section h2 {
            font-size: 2.5rem;
            color: #3b82f6;
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }

        #export-section form {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            align-items: center;
        }

        /* Cont√™iner de Exporta√ß√£o Tempor√°rio */
        .export-container {
            background: #141e30;
            padding: 2rem;
            border-radius: 12px;
            color: #ffffff;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            position: absolute;
            left: -9999px;
            width: 800px;
            min-height: 400px;
            display: block;
        }

        .export-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #3b82f6, #7c3aed);
        }

        .export-container h3 {
            font-size: 2.2rem;
            color: #7c3aed;
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(124, 58, 237, 0.5);
        }

        .export-container table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
        }

        .export-container th, .export-container td {
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: left;
            font-size: 0.95rem;
        }

        .export-container th {
            background: rgba(59, 130, 246, 0.4);
            color: #ffffff;
            font-weight: 600;
        }

        .export-container td {
            background: rgba(255, 255, 255, 0.05);
        }

        .export-container canvas {
            max-width: 100%;
            max-height: 300px;
            margin: 1.5rem auto;
        }

        /* Se√ß√£o de Hist√≥rico e Gerenciamento */
        #historico {
            padding: 3rem 0;
            margin: 2rem 0;
        }

        #historico h2 {
            font-size: 2.5rem;
            color: #3b82f6;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }

        #historico-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        #management-section {
            background: rgba(20, 30, 48, 0.95);
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(6px);
        }

        #management-section h2 {
            font-size: 2.5rem;
            color: #3b82f6;
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }

        #management-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }

        #management-table th, #management-table td {
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: left;
            font-size: 0.95rem;
        }

        #management-table th {
            background: rgba(59, 130, 246, 0.4);
            color: #ffffff;
            font-weight: 600;
        }

        #management-table td {
            background: rgba(255, 255, 255, 0.05);
        }

        .edit-btn, .delete-btn {
            color: #ffffff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 0.3rem;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        .edit-btn {
            background: #3b82f6;
        }

        .edit-btn:hover {
            background: #1e40af;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.6);
        }

        .delete-btn {
            background: #f87171;
        }

        .delete-btn:hover {
            background: #b91c1c;
            box-shadow: 0 0 10px rgba(248, 113, 113, 0.6);
        }

        /* Rodap√© */
        footer {
            background: linear-gradient(135deg, #0a1122, #1a2236);
            color: #ffffff;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 3rem;
        }

        /* Media Queries para Responsividade */
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }
            nav {
                display: none;
            }
            nav.active {
                display: block;
                position: absolute;
                top: 3.5rem;
                left: 0;
                width: 100%;
                background: rgba(10, 17, 34, 0.95);
                padding: 1.5rem;
            }
            nav ul {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            header h1 {
                font-size: 1.5rem;
            }

            #form-section h2, #summary-section h2, .profit-section h2, #export-section h2, #historico h2, #management-section h2 {
                font-size: 2rem;
            }

            form {
                grid-template-columns: 1fr;
            }

            .profit-card h3 {
                font-size: 2rem;
            }

            .profit-item {
                padding: 1rem;
            }

            .profit-list {
                grid-template-columns: 1fr;
            }

            .chart-container {
                max-width: 100%;
                padding: 1rem;
            }

            #summary-chart, #weeklyChart {
                max-height: 300px;
            }

            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }

            #export-section form {
                flex-direction: column;
            }

            .export-container {
                width: 100%;
                max-width: 500px;
            }

            #management-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            #management-table th, #management-table td {
                font-size: 0.85rem;
                padding: 0.5rem;
            }
        }

        @media (min-width: 768px) and (max-width: 1024px) {
            .profit-list {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            #form-section h2, #summary-section h2, .profit-section h2, #export-section h2, #historico h2, #management-section h2 {
                font-size: 2.2rem;
            }

            .profit-card h3 {
                font-size: 2.5rem;
            }

            .export-container {
                width: 600px;
            }
        }
    </style>
</head>
<body>
    <!-- Cabe√ßalho -->
    <header>
        <div class="container">
            <h1>Lucro em Criptomoedas</h1>
            <div class="menu-toggle">‚ò∞</div>
            <nav>
                <ul>
                    <li><a href="#form-section">Adicionar</a></li>
                    <li><a href="#summary-section">Resumo</a></li>
                    <li><a href="#export-section">Exportar</a></li>
                    <li><a href="#historico">Hist√≥rico</a></li>
                    <li><a href="#management-section">Gerenciar</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Se√ß√£o Principal -->
    <main>
        <!-- Formul√°rio para Adicionar Lucros -->
        <section id="form-section">
            <div class="container">
                <h2>Adicionar Lucro</h2>
                <form id="profit-form">
                    <input type="text" id="crypto" placeholder="Criptomoeda (ex: Bitcoin)" required>
                    <input type="number" id="invested" placeholder="Valor Investido (R$)" step="0.01" min="0" required>
                    <input type="number" id="profit" placeholder="Lucro (R$)" step="0.01" required>
                    <button type="submit">Adicionar</button>
                </form>
                <p id="error-message" class="error"></p>
            </div>
        </section>

        <!-- Modal de Edi√ß√£o -->
        <div id="edit-modal" class="modal">
            <div class="modal-content">
                <h2>Editar Lucro</h2>
                <form id="edit-form">
                    <input type="text" id="edit-crypto" placeholder="Criptomoeda" required>
                    <input type="number" id="edit-invested" placeholder="Valor Investido (R$)" step="0.01" min="0" required>
                    <input type="number" id="edit-profit" placeholder="Lucro (R$)" step="0.01" required>
                    <input type="hidden" id="edit-index">
                    <button type="submit">Salvar</button>
                    <button type="button" class="close-btn" onclick="closeModal()">Cancelar</button>
                </form>
                <p id="edit-error-message" class="error"></p>
            </div>
        </div>

        <!-- Se√ß√£o de Resumo para Download -->
        <section id="summary-section">
            <div class="container">
                <h2>Resumo de Lucros</h2>
                <div id="summary-content">
                    <h3>Resumo Financeiro</h3>
                    <p id="summary-daily">Lucro Di√°rio: R$ 0,00</p>
                    <p id="summary-weekly">Lucro Semanal: R$ 0,00</p>
                    <p id="summary-monthly">Lucro Mensal: R$ 0,00</p>
                    <p id="summary-total">Lucro Total: R$ 0,00</p>
                    <p id="summary-percentage">Porcentagem de Aumento: 0%</p>
                    <div class="chart-container">
                        <canvas id="summary-chart"></canvas>
                    </div>
                </div>
                <button id="download-btn">Baixar Imagem</button>
            </div>
        </section>

        <!-- Se√ß√£o de Exporta√ß√£o -->
        <section id="export-section">
            <div class="container">
                <h2>Exportar Lucros</h2>
                <form id="export-form">
                    <select id="week-select" required>
                        <option value="">Selecione uma semana</option>
                    </select>
                    <button type="button" id="download-week-btn">Baixar Semana (PNG)</button>
                    <select id="month-select" required>
                        <option value="">Selecione um m√™s</option>
                    </select>
                    <button type="button" id="download-month-btn">Baixar M√™s (PNG)</button>
                </form>
                <div id="export-week-container" class="export-container"></div>
                <div id="export-month-container" class="export-container"></div>
            </div>
        </section>

        <!-- Se√ß√£o de Lucro Di√°rio -->
        <section id="diario" class="profit-section">
            <div class="container">
                <h2>Lucro Di√°rio</h2>
                <div class="profit-card">
                    <h3 id="diario-total">R$ 0,00</h3>
                    <p>Lucro acumulado hoje</p>
                </div>
                <div id="diario-list" class="profit-list"></div>
            </div>
        </section>

        <!-- Se√ß√£o de Lucro Semanal -->
        <section id="semanal" class="profit-section">
            <div class="container">
                <h2>Lucro Semanal</h2>
                <div class="profit-card">
                    <h3 id="semanal-total">R$ 0,00</h3>
                    <p>Lucro acumulado nos √∫ltimos 7 dias</p>
                </div>
                <div id="semanal-list" class="profit-list"></div>
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de Lucro Mensal -->
        <section id="mensal" class="profit-section">
            <div class="container">
                <h2>Lucro Mensal</h2>
                <div class="profit-card">
                    <h3 id="mensal-total">R$ 0,00</h3>
                    <p>Lucro acumulado nos √∫ltimos 30 dias</p>
                </div>
                <div id="mensal-list" class="profit-list"></div>
            </div>
        </section>

        <!-- Se√ß√£o de Hist√≥rico -->
        <section id="historico" class="profit-section">
            <div class="container">
                <h2>Hist√≥rico de Lucros</h2>
                <div id="historico-list" class="profit-list"></div>
            </div>
        </section>

        <!-- Se√ß√£o de Gerenciamento -->
        <section id="management-section">
            <div class="container">
                <h2>Gerenciar Lucros</h2>
                <div style="overflow-x: auto;">
                    <table id="management-table">
                        <thead>
                            <tr>
                                <th>Criptomoeda</th>
                                <th>Data</th>
                                <th>Investido</th>
                                <th>Lucro</th>
                                <th>Porcentagem</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="management-table-body"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Rodap√© -->
    <footer>
        <div class="container">
            <p>¬© 2025 Lucro em Criptomoedas. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        // Registrar o plugin datalabels
        Chart.register(ChartDataLabels);

        // Verificar elementos DOM no carregamento
        window.addEventListener('DOMContentLoaded', () => {
            const requiredIds = ['diario-list', 'diario-total', 'semanal-list', 'semanal-total', 'mensal-list', 'mensal-total', 'summary-chart', 'weeklyChart', 'historico-list', 'export-week-container', 'export-month-container', 'management-table-body'];
            requiredIds.forEach(id => {
                if (!document.getElementById(id)) {
                    console.error(`Elemento com ID "${id}" n√£o encontrado no DOM.`);
                }
            });
        });

        // Inicializar dados do localStorage
        let profits = [];
        try {
            const stored = JSON.parse(localStorage.getItem('profits'));
            if (Array.isArray(stored)) {
                profits = stored;
            } else {
                console.warn('Dados inv√°lidos no localStorage. Inicializando como array vazio.');
                localStorage.setItem('profits', JSON.stringify(profits));
            }
        } catch (e) {
            console.error('Erro ao parsear localStorage:', e);
            localStorage.setItem('profits', JSON.stringify(profits));
        }

        // Fun√ß√£o para formatar valores em reais
        const formatCurrency = (value) => {
            return `R$ ${parseFloat(value).toFixed(2).replace('.', ',')}`;
        };

        // Fun√ß√£o para formatar data
        const formatDate = (timestamp) => {
            return new Date(timestamp).toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        };

        // Fun√ß√£o para calcular a porcentagem de lucro
        const calculatePercentage = (invested, profit) => {
            if (parseFloat(invested) === 0) return '0%';
            const percentage = (parseFloat(profit) / parseFloat(invested)) * 100;
            return `${percentage.toFixed(2)}%`;
        };

        // Fun√ß√£o para determinar os per√≠odos aplic√°veis
        const getPeriods = (timestamp) => {
            const periods = [];
            const now = new Date();
            const entryDate = new Date(timestamp);
            const diffTime = now - entryDate;
            const diffDays = diffTime / (1000 * 60 * 60 * 24);

            const isSameDay = now.getFullYear() === entryDate.getFullYear() &&
                             now.getMonth() === entryDate.getMonth() &&
                             now.getDate() === entryDate.getDate();
            if (isSameDay) periods.push('diario');

            if (diffDays <= 7) periods.push('semanal');

            if (diffDays <= 30) periods.push('mensal');

            return periods;
        };

        // Fun√ß√£o para calcular o total de lucros por per√≠odo
        const calculateTotal = (period) => {
            return profits
                .filter(entry => getPeriods(entry.timestamp).includes(period))
                .reduce((sum, entry) => sum + parseFloat(entry.profit), 0);
        };

        // Fun√ß√£o para calcular a porcentagem total de aumento
        const calculateTotalPercentage = () => {
            const totalInvested = profits.reduce((sum, entry) => sum + parseFloat(entry.invested), 0);
            const totalProfit = profits.reduce((sum, entry) => sum + parseFloat(entry.profit), 0);
            if (totalInvested === 0) return '0%';
            const percentage = (totalProfit / totalInvested) * 100;
            return `${percentage.toFixed(2)}%`;
        };

        // Fun√ß√£o para criar gradiente para o gr√°fico
        const createGradient = (ctx, chartArea) => {
            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
            gradient.addColorStop(0, '#3b82f6');
            gradient.addColorStop(1, '#7c3aed');
            return gradient;
        };

        // Fun√ß√£o para obter semanas dispon√≠veis
        const getAvailableWeeks = () => {
            const weeks = new Set();
            profits.forEach(entry => {
                const date = new Date(entry.timestamp);
                const startOfWeek = new Date(date);
                startOfWeek.setDate(date.getDate() - date.getDay());
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(startOfWeek.getDate() + 6);
                const weekKey = `${startOfWeek.toISOString().split('T')[0]}_${endOfWeek.toISOString().split('T')[0]}`;
                weeks.add(weekKey);
            });
            return Array.from(weeks).sort();
        };

        // Fun√ß√£o para obter meses dispon√≠veis
        const getAvailableMonths = () => {
            const months = new Set();
            profits.forEach(entry => {
                const date = new Date(entry.timestamp);
                const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`;
                months.add(monthKey);
            });
            return Array.from(months).sort();
        };

        // Fun√ß√£o para formatar m√™s
        const formatMonth = (monthKey) => {
            const [year, month] = monthKey.split('-').map(Number);
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            return `${monthNames[month - 1]} de ${year}`;
        };

        // Fun√ß√£o para formatar semana
        const formatWeek = (weekKey) => {
            const [start] = weekKey.split('_');
            const startDate = new Date(start);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            return `${formatDate(start)} a ${formatDate(endDate.toISOString())}`;
        };

        // Fun√ß√£o para atualizar seletores de exporta√ß√£o
        const updateExportSelectors = () => {
            const weekSelect = document.getElementById('week-select');
            const monthSelect = document.getElementById('month-select');

            weekSelect.innerHTML = '<option value="">Selecione uma semana</option>';
            const weeks = getAvailableWeeks();
            weeks.forEach(week => {
                const option = document.createElement('option');
                option.value = week;
                option.textContent = formatWeek(week);
                weekSelect.appendChild(option);
            });

            monthSelect.innerHTML = '<option value="">Selecione um m√™s</option>';
            const months = getAvailableMonths();
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = formatMonth(month);
                monthSelect.appendChild(option);
            });
        };

        // Fun√ß√£o para gerar cont√™iner de exporta√ß√£o
        const generateExportContainer = (title, profits) => {
            const totalProfit = profits.reduce((sum, entry) => sum + parseFloat(entry.profit), 0);
            let html = `
                <h3>${title}</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Criptomoeda</th>
                            <th>Data</th>
                            <th>Investido</th>
                            <th>Lucro</th>
                            <th>Porcentagem</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            profits.forEach(entry => {
                html += `
                    <tr>
                        <td>${entry.crypto}</td>
                        <td>${formatDate(entry.timestamp)}</td>
                        <td>${formatCurrency(entry.invested)}</td>
                        <td>${formatCurrency(entry.profit)}</td>
                        <td>${calculatePercentage(entry.invested, entry.profit)}</td>
                    </tr>
                `;
            });
            html += `
                    </tbody>
                </table>
                <p style="font-size: 1.3rem; font-weight: bold;">Total: ${formatCurrency(totalProfit)}</p>
                <div class="chart-container">
                    <canvas id="export-chart"></canvas>
                </div>
            `;
            return html;
        };

        // Fun√ß√£o para criar gr√°fico de exporta√ß√£o
        const createExportChart = (canvas, type, data, labels, title) => {
            if (!canvas) {
                console.error('Canvas n√£o encontrado para criar gr√°fico de exporta√ß√£o.');
                return null;
            }

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            console.log(`Criando gr√°fico de exporta√ß√£o tipo ${type} com dados:`, data);

            const chart = new Chart(canvas, {
                type,
                data: {
                    labels,
                    datasets: [{
                        label: title,
                        data,
                        backgroundColor: type === 'bar' ? (context) => createGradient(context.chart.canvas.getContext('2d'), context.chart.chartArea) : ['#3b82f6', '#7c3aed', '#10b981'],
                        borderColor: type === 'bar' ? '#3b82f6' : ['#1e40af', '#4c1d95', '#065f46'],
                        borderWidth: 2,
                        borderRadius: type === 'bar' ? 5 : 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    scales: type === 'bar' ? {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: (value) => formatCurrency(value), color: '#ffffff' }
                        },
                        x: { ticks: { color: '#ffffff' } }
                    } : {},
                    plugins: {
                        legend: { labels: { color: '#ffffff', font: { size: 16, weight: 'bold' } } },
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${formatCurrency(context.raw)}` } },
                        datalabels: {
                            formatter: (value, context) => {
                                if (type === 'bar') return formatCurrency(value);
                                const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                return `${percentage}%`;
                            },
                            color: '#ffffff',
                            font: { weight: 'bold', size: 14 },
                            anchor: type === 'bar' ? 'end' : 'center',
                            align: type === 'bar' ? 'top' : 'center',
                            textShadow: '0 0 5px rgba(0,0,0,0.5)'
                        }
                    }
                }
            });
            chart.render();
            return chart;
        };

        // Debounce para fun√ß√µes de atualiza√ß√£o
        let updateTimeout = null;
        const debounce = (func, delay) => {
            return (...args) => {
                clearTimeout(updateTimeout);
                updateTimeout = setTimeout(() => func(...args), delay);
            };
        };

        // Fun√ß√£o para atualizar as listas de lucros, resumo, hist√≥rico e gerenciamento
        const updateLists = () => {
            console.log('Atualizando listas e gr√°ficos...');

            const periods = ['diario', 'semanal', 'mensal'];
            periods.forEach(period => {
                const listElement = document.querySelector(`#${period}-list`);
                const totalElement = document.querySelector(`#${period}-total`);

                if (!listElement || !totalElement) {
                    console.error(`Elemento #${period}-list ou #${period}-total n√£o encontrado.`);
                    return;
                }

                listElement.innerHTML = '';

                const filteredProfits = profits.filter(entry => getPeriods(entry.timestamp).includes(period));
                console.log(`Lucros para ${period}:`, filteredProfits);
                filteredProfits.forEach((entry, index) => {
                    const globalIndex = profits.indexOf(entry);
                    const item = document.createElement('div');
                    item.className = 'profit-item';
                    item.innerHTML = `
                        <h4>${entry.crypto}</h4>
                        <p>Data: ${formatDate(entry.timestamp)}</p>
                        <p>Investido: ${formatCurrency(entry.invested)}</p>
                        <p>Lucro: ${formatCurrency(entry.profit)}</p>
                        <p>Porcentagem: ${calculatePercentage(entry.invested, entry.profit)}</p>
                    `;
                    listElement.appendChild(item);
                });

                totalElement.textContent = formatCurrency(calculateTotal(period));
            });

            // Atualizar hist√≥rico
            const historicoList = document.querySelector('#historico-list');
            if (historicoList) {
                historicoList.innerHTML = '';
                const sortedProfits = [...profits].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                sortedProfits.forEach((entry, index) => {
                    const globalIndex = profits.indexOf(entry);
                    const item = document.createElement('div');
                    item.className = 'profit-item';
                    item.innerHTML = `
                        <h4>${entry.crypto}</h4>
                        <p>Data: ${formatDate(entry.timestamp)}</p>
                        <p>Investido: ${formatCurrency(entry.invested)}</p>
                        <p>Lucro: ${formatCurrency(entry.profit)}</p>
                        <p>Porcentagem: ${calculatePercentage(entry.invested, entry.profit)}</p>
                    `;
                    historicoList.appendChild(item);
                });
            }

            // Atualizar tabela de gest√£o
            const managementTableBody = document.querySelector('#management-table-body');
            if (managementTableBody) {
                managementTableBody.innerHTML = '';
                const sortedProfits = [...profits].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                sortedProfits.forEach((entry, index) => {
                    const globalIndex = profits.indexOf(entry);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${entry.crypto}</td>
                        <td>${formatDate(entry.timestamp)}</td>
                        <td>${formatCurrency(entry.invested)}</td>
                        <td>${formatCurrency(entry.profit)}</td>
                        <td>${calculatePercentage(entry.invested, entry.profit)}</td>
                        <td>
                            <button class="edit-btn" onclick="openEditModal(${globalIndex})">Editar</button>
                            <button class="delete-btn" onclick="deleteEntry(${globalIndex})">Remover</button>
                        </td>
                    `;
                    managementTableBody.appendChild(row);
                });
            }

            // Atualizar resumo
            const summaryDaily = document.querySelector('#summary-daily');
            const summaryWeekly = document.querySelector('#summary-weekly');
            const summaryMonthly = document.querySelector('#summary-monthly');
            const summaryTotal = document.querySelector('#summary-total');
            const summaryPercentage = document.querySelector('#summary-percentage');

            if (summaryDaily && summaryWeekly && summaryMonthly && summaryTotal && summaryPercentage) {
                summaryDaily.textContent = `Lucro Di√°rio: ${formatCurrency(calculateTotal('diario'))}`;
                summaryWeekly.textContent = `Lucro Semanal: ${formatCurrency(calculateTotal('semanal'))}`;
                summaryMonthly.textContent = `Lucro Mensal: ${formatCurrency(calculateTotal('mensal'))}`;
                const totalProfit = profits.reduce((sum, entry) => sum + parseFloat(entry.profit), 0);
                summaryTotal.textContent = `Lucro Total: ${formatCurrency(totalProfit)}`;
                summaryPercentage.textContent = `Porcentagem de Aumento: ${calculateTotalPercentage()}`;
            }

            updateExportSelectors();
            debouncedUpdateSummaryChart();
            debouncedUpdateWeeklyChart();
        };

        // Fun√ß√£o para adicionar lucro
        document.getElementById('profit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = '';

            const crypto = document.getElementById('crypto').value.trim();
            const invested = parseFloat(document.getElementById('invested').value);
            const profit = parseFloat(document.getElementById('profit').value);

            if (!crypto) {
                errorMessage.textContent = 'Por favor, insira o nome da criptomoeda.';
                return;
            }
            if (isNaN(invested) || invested < 0) {
                errorMessage.textContent = 'Por favor, insira um valor investido v√°lido.';
                return;
            }
            if (isNaN(profit)) {
                errorMessage.textContent = 'Por favor, insira um lucro v√°lido.';
                return;
            }

            const entry = {
                crypto,
                invested,
                profit,
                timestamp: new Date().toISOString()
            };

            if (!Array.isArray(profits)) {
                console.error('profits n√£o √© um array. Reinicializando.');
                profits = [];
            }

            profits.push(entry);
            localStorage.setItem('profits', JSON.stringify(profits));
            debouncedUpdateLists();

            e.target.reset();
        });

        // Fun√ß√£o para abrir o modal de edi√ß√£o
        window.openEditModal = (index) => {
            const entry = profits[index];
            document.getElementById('edit-crypto').value = entry.crypto;
            document.getElementById('edit-invested').value = entry.invested;
            document.getElementById('edit-profit').value = entry.profit;
            document.getElementById('edit-index').value = index;
            document.getElementById('edit-modal').style.display = 'flex';
        };

        // Fun√ß√£o para fechar o modal
        window.closeModal = () => {
            document.getElementById('edit-modal').style.display = 'none';
            document.getElementById('edit-form').reset();
            document.getElementById('edit-error-message').textContent = '';
        };

        // Fun√ß√£o para editar lucro
        document.getElementById('edit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const errorMessage = document.getElementById('edit-error-message');
            errorMessage.textContent = '';

            const crypto = document.getElementById('edit-crypto').value.trim();
            const invested = parseFloat(document.getElementById('edit-invested').value);
            const profit = parseFloat(document.getElementById('edit-profit').value);
            const index = parseInt(document.getElementById('edit-index').value);

            if (!crypto) {
                errorMessage.textContent = 'Por favor, insira o nome da criptomoeda.';
                return;
            }
            if (isNaN(invested) || invested < 0) {
                errorMessage.textContent = 'Por favor, insira um valor investido v√°lido.';
                return;
            }
            if (isNaN(profit)) {
                errorMessage.textContent = 'Por favor, insira um lucro v√°lido.';
                return;
            }

            if (!Array.isArray(profits)) {
                console.error('profits n√£o √© um array. Reinicializando.');
                profits = [];
            }

            profits[index] = {
                crypto,
                invested,
                profit,
                timestamp: profits[index].timestamp
            };

            localStorage.setItem('profits', JSON.stringify(profits));
            debouncedUpdateLists();
            closeModal();
        });

        // Fun√ß√£o para remover entrada
        window.deleteEntry = (index) => {
            if (confirm('Tem certeza que deseja remover este lucro?')) {
                if (!Array.isArray(profits)) {
                    console.error('profits n√£o √© um array. Reinicializando.');
                    profits = [];
                }
                profits.splice(index, 1);
                localStorage.setItem('profits', JSON.stringify(profits));
                debouncedUpdateLists();
            }
        };

        // Fun√ß√£o para atualizar o gr√°fico semanal
        let weeklyChart = null;
        const updateWeeklyChart = () => {
            const canvas = document.getElementById('weeklyChart');
            if (!canvas) {
                console.error('Elemento #weeklyChart n√£o encontrado.');
                return;
            }

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Destruir gr√°fico existente, se houver
            if (weeklyChart && typeof weeklyChart.destroy === 'function') {
                console.log('Destruindo gr√°fico semanal existente.');
                weeklyChart.destroy();
                weeklyChart = null;
            }

            const weeklyProfits = profits
                .filter(entry => getPeriods(entry.timestamp).includes('semanal'))
                .reduce((acc, entry) => {
                    acc[entry.crypto] = (acc[entry.crypto] || 0) + parseFloat(entry.profit);
                    return acc;
                }, {});

            const labels = Object.keys(weeklyProfits);
            const data = Object.values(weeklyProfits);

            if (labels.length === 0) {
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'center';
                ctx.fillText('Nenhum dado dispon√≠vel', canvas.width / 2, canvas.height / 2);
                console.log('Nenhum dado para o gr√°fico semanal.');
                return;
            }

            console.log('Criando novo gr√°fico semanal com dados:', { labels, data });

            weeklyChart = new Chart(canvas, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Lucro Semanal (R$)',
                        data,
                        backgroundColor: (context) => createGradient(context.chart.canvas.getContext('2d'), context.chart.chartArea),
                        borderColor: '#3b82f6',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 1000, easing: 'easeOutQuart' },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: (value) => formatCurrency(value), color: '#ffffff' }
                        },
                        x: { ticks: { color: '#ffffff' } }
                    },
                    plugins: {
                        legend: { labels: { color: '#ffffff' } },
                        tooltip: { callbacks: { label: (context) => `Lucro: ${formatCurrency(context.raw)}` } },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            formatter: (value) => formatCurrency(value),
                            color: '#ffffff',
                            font: { weight: 'bold' },
                            textShadow: '0 0 5px rgba(0,0,0,0.5)'
                        }
                    }
                }
            });
            weeklyChart.render();
            console.log('Gr√°fico semanal criado com sucesso.');
        };

        // Fun√ß√£o para atualizar o gr√°fico do resumo
        let summaryChart = null;
        const updateSummaryChart = () => {
            const canvas = document.getElementById('summary-chart');
            if (!canvas) {
                console.error('Elemento #summary-chart n√£o encontrado.');
                return;
            }

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Destruir gr√°fico existente, se houver
            if (summaryChart && typeof summaryChart.destroy === 'function') {
                console.log('Destruindo gr√°fico de resumo existente.');
                summaryChart.destroy();
                summaryChart = null;
            }

            const data = [
                calculateTotal('diario'),
                calculateTotal('semanal'),
                calculateTotal('mensal')
            ];

            if (data.every(val => val === 0)) {
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'center';
                ctx.fillText('Nenhum dado dispon√≠vel', canvas.width / 2, canvas.height / 2);
                console.log('Nenhum dado para o gr√°fico de resumo.');
                return;
            }

            console.log('Criando novo gr√°fico de resumo com dados:', data);

            summaryChart = new Chart(canvas, {
                type: 'pie',
                data: {
                    labels: ['Di√°rio', 'Semanal', 'Mensal'],
                    datasets: [{
                        label: 'Lucros',
                        data,
                        backgroundColor: ['#3b82f6', '#7c3aed', '#10b981'],
                        borderColor: ['#1e40af', '#4c1d95', '#065f46'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#ffffff', font: { size: 16, weight: 'bold' } }
                        },
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${formatCurrency(context.raw)}` } },
                        datalabels: {
                            formatter: (value, context) => {
                                const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                return `${percentage}%`;
                            },
                            color: '#ffffff',
                            font: { weight: 'bold', size: 14 },
                            textShadow: '0 0 5px rgba(0,0,0,0.5)'
                        }
                    }
                }
            });
            summaryChart.render();
            console.log('Gr√°fico de resumo criado com sucesso.');
        };

        // Fun√ß√£o para baixar imagem do resumo
        document.getElementById('download-btn').addEventListener('click', () => {
            const summarySection = document.getElementById('summary-content');
            if (!summarySection) {
                console.error('Elemento #summary-content n√£o encontrado.');
                alert('Falha ao encontrar o resumo. Tente novamente.');
                return;
            }

            if (profits.length === 0) {
                alert('Nenhum lucro registrado para exportar.');
                return;
            }

            updateSummaryChart();
            if (summaryChart) {
                summaryChart.render();
            }

            console.log('Conte√∫do de #summary-content antes da captura:', summarySection.innerHTML);

            const originalStyle = summarySection.style.cssText;
            summarySection.style.background = '#141e30';
            summarySection.style.width = '800px';
            summarySection.style.minHeight = '400px';

            setTimeout(() => {
                html2canvas(summarySection, {
                    backgroundColor: '#141e30',
                    scale: 4,
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'resumo_lucros.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    summarySection.style.cssText = originalStyle;
                }).catch(err => {
                    console.error('Erro ao gerar imagem:', err);
                    alert('Falha ao baixar a imagem. Tente novamente.');
                    summarySection.style.cssText = originalStyle;
                });
            }, 1500);
        });

        // Fun√ß√µes para exportar PNG
        document.getElementById('download-week-btn').addEventListener('click', () => {
            const weekKey = document.getElementById('week-select').value;
            if (!weekKey) {
                alert('Por favor, selecione uma semana.');
                return;
            }

            const [start, end] = weekKey.split('_');
            const startDate = new Date(start);
            const endDate = new Date(end);
            const filteredProfits = profits.filter(entry => {
                const entryDate = new Date(entry.timestamp);
                return entryDate >= startDate && entryDate <= endDate;
            });

            if (filteredProfits.length === 0) {
                alert('Nenhum lucro encontrado para esta semana.');
                return;
            }

            const container = document.getElementById('export-week-container');
            container.innerHTML = generateExportContainer(`Lucros da Semana: ${formatWeek(weekKey)}`, filteredProfits);

            console.log('Conte√∫do de #export-week-container:', container.innerHTML);

            const canvas = container.querySelector('#export-chart');
            const weeklyProfits = filteredProfits.reduce((acc, entry) => {
                acc[entry.crypto] = (acc[entry.crypto] || 0) + parseFloat(entry.profit);
                return acc;
            }, {});
            const labels = Object.keys(weeklyProfits);
            const data = Object.values(weeklyProfits);

            if (labels.length === 0) {
                container.innerHTML = '<p>Nenhum dado dispon√≠vel para esta semana.</p>';
                return;
            }

            const chart = createExportChart(canvas, 'bar', data, labels, 'Lucro Semanal (R$)');

            setTimeout(() => {
                html2canvas(container, {
                    backgroundColor: '#141e30',
                    scale: 4,
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `lucros_semana_${formatDate(start).replace(/\//g, '-')}_${formatDate(end).replace(/\//g, '-')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    if (chart) chart.destroy();
                    container.innerHTML = '';
                }).catch(err => {
                    console.error('Erro ao gerar PNG:', err);
                    alert('Falha ao baixar a imagem. Tente novamente.');
                    if (chart) chart.destroy();
                    container.innerHTML = '';
                });
            }, 1500);
        });

        document.getElementById('download-month-btn').addEventListener('click', () => {
            const monthKey = document.getElementById('month-select').value;
            if (!monthKey) {
                alert('Por favor, selecione um m√™s.');
                return;
            }

            const [year, month] = monthKey.split('-').map(Number);
            const filteredProfits = profits.filter(entry => {
                const entryDate = new Date(entry.timestamp);
                return entryDate.getFullYear() === year && (entryDate.getMonth() + 1) === month;
            });

            if (filteredProfits.length === 0) {
                alert('Nenhum lucro encontrado para este m√™s.');
                return;
            }

            const container = document.getElementById('export-month-container');
            container.innerHTML = generateExportContainer(`Lucros de ${formatMonth(monthKey)}`, filteredProfits);

            console.log('Conte√∫do de #export-month-container:', container.innerHTML);

            const canvas = container.querySelector('#export-chart');
            const monthlyProfits = filteredProfits.reduce((acc, entry) => {
                acc[entry.crypto] = (acc[entry.crypto] || 0) + parseFloat(entry.profit);
                return acc;
            }, {});
            const labels = Object.keys(monthlyProfits);
            const data = Object.values(monthlyProfits);

            if (labels.length === 0) {
                container.innerHTML = '<p>Nenhum dado dispon√≠vel para este m√™s.</p>';
                return;
            }

            const chart = createExportChart(canvas, 'pie', data, labels, 'Lucro Mensal (R$)');

            setTimeout(() => {
                html2canvas(container, {
                    backgroundColor: '#141e30',
                    scale: 4,
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `lucros_${formatMonth(monthKey).toLowerCase().replace(' de ', '_')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    if (chart) chart.destroy();
                    container.innerHTML = '';
                }).catch(err => {
                    console.error('Erro ao gerar PNG:', err);
                    alert('Falha ao baixar a imagem. Tente novamente.');
                    if (chart) chart.destroy();
                    container.innerHTML = '';
                });
            }, 1500);
        });

        // Menu hamburguer
        document.querySelector('.menu-toggle').addEventListener('click', () => {
            const nav = document.querySelector('nav');
            nav.classList.toggle('active');
        });

        // Fun√ß√µes debounced
        const debouncedUpdateLists = debounce(updateLists, 100);
        const debouncedUpdateSummaryChart = debounce(updateSummaryChart, 100);
        const debouncedUpdateWeeklyChart = debounce(updateWeeklyChart, 100);

        // Inicializar listas, gr√°ficos e seletores
        debouncedUpdateLists();
    </script>
</body>
</html>